name: LaTeX
on: [push]
jobs:
  build_latex:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git repository
        uses: actions/checkout@v4
        
      - name: Install Full TeX Live and Fonts
        run: |
          sudo apt-get update
          # 安装完整TeX Live套件确保所有依赖
          sudo apt-get install -y texlive-full
          # 安装中文字体包
          sudo apt-get install -y fonts-noto-cjk fonts-arphic-ukai fonts-arphic-uming
          # 安装缺失的特定字体
          sudo apt-get install -y texlive-fonts-recommended
          sudo apt-get install -y texlive-fonts-extra
          # 清理缓存减少空间
          sudo apt-get clean
          
      - name: Compile LaTeX Document
        uses: xu-cheng/latex-action@v3
        with:
          root_file: SAA_hw09.tex
          # 强制使用XeLaTeX引擎（更好支持中文）
          compiler: xelatex
          # 增加编译次数解决引用问题
          compiler_args: |
            -synctex=1
            -interaction=nonstopmode
          pre_compile: |
            xelatex -synctex=1 -interaction=nonstopmode SAA_hw09.tex
            biber SAA_hw09
          post_compile: |
            xelatex -synctex=1 -interaction=nonstopmode SAA_hw09.tex
            xelatex -synctex=1 -interaction=nonstopmode SAA_hw09.tex
            
      - name: Upload PDF file
        if: success()  # 仅在编译成功时上传
        uses: actions/upload-artifact@v4
        with:
          name: PDF
          path: SAA_hw09.pdf
