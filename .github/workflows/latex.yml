name: LaTeX to PDF
on: [push]
jobs:
  build_latex:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            texlive-full \
            latexmk \
            fonts-noto-cjk \
            fonts-wqy-zenhei \
            fonts-arphic-ukai \
            fonts-arphic-uming \
            fonts-arphic-gbsn00lp \
            fonts-arphic-bsmi00lp \
            fonts-arphic-gkai00mp \
            fonts-arphic-bkai00mp \
            aspell \
            aspell-en
          sudo apt-get clean

      - name: Spellcheck with aspell
        run: |
          for file in *.tex; do
            echo "ğŸ” Spellchecking $file..."
            aspell --lang=en --mode=tex list < "$file" | sort | uniq > "${file%.tex}.spellerrors"
            
            if [ -s "${file%.tex}.spellerrors" ]; then
              echo "::warning::Spelling errors found in $file"
              echo "âŒ Misspelled words:"
              cat "${file%.tex}.spellerrors"
            else
              echo "âœ… No spelling errors found in $file"
            fi
          done

      - name: Compile with latexmk
        run: |
          # è®¾ç½®ä¸­æ–‡å­—ä½“ç¯å¢ƒå˜é‡
          export OSFONTDIR="/usr/share/fonts//"
          
          # é¢„ç¼–è¯‘ç”Ÿæˆå­—ä½“ç¼“å­˜
          xelatex -no-pdf -interaction=nonstopmode SAA_hw09.tex || true
          
          # æ­£å¼ç¼–è¯‘
          latexmk -xelatex -synctex=1 -interaction=nonstopmode -f SAA_hw09.tex

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: PDF
          path: SAA_hw09.pdf
